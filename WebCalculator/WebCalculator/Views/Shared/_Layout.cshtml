<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - .NET Core 1.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Add local styles, mostly for plugins css file -->
    @if (IsSectionDefined("Styles"))
    {@RenderSection("Styles", required: false)}
    <environment names="Development">
        <link rel="stylesheet" href="~/lib_bower/toastr/toastr.css" />
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="~/lib_bower/font-awesome/css/font-awesome.css" />
        <link rel="stylesheet" href="~/lib_bower/metisMenu/dist/metisMenu.css" />
        <link rel="stylesheet" href="~/css/animate.css" />
        <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    </environment>
    <environment names="Staging,Production">
        <link rel="stylesheet" href="~/lib_bower/toastr/toastr.min.css" />
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/lib_bower/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="~/lib_bower/metisMenu/dist/metisMenu.min.css" />
        <link rel="stylesheet" href="~/css/animate.css" />
        <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    </environment>    
</head>
<body>
    <!-- Skin configuration box -->
    <!-- @Html.Partial("_SkinConfig") -->
    <!-- Wrapper-->
    <div id="wrapper" class="@Html.PageClass()">
        <!-- Navigation -->
        @Html.Partial("_Navigation")
        <!-- Page wraper -->
        <div id="page-wrapper" class="gray-bg @ViewBag.SpecialClass">
            <!-- Top Navbar -->
            @Html.Partial("_TopNavbar")
            <!-- Main view  -->
            @RenderBody()
            <!-- Footer -->
            @Html.Partial("_Footer")
        </div>
        <!-- End page wrapper-->
        <!-- Right Sidebar -->
        @Html.Partial("_RightSidebar")
    </div>
    <!-- End wrapper-->
    <environment names="Development">
        <script src="~/lib/jquery/dist/jquery.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
        <script src="~/lib_bower/metisMenu/dist/metisMenu.js"></script>
        <script src="~/lib_bower/slimScroll/jquery.slimscroll.js"></script>
        <script data-pace-options='{ "ajax": false,  "restartOnRequestAfter": false }' src="~/lib_bower/pace/pace.js"></script>
        <script src="~/lib_bower/toastr/toastr.js"></script>
        <script src="~/js/script.js"></script>
        <script src="~/js/signalr.js"></script>
        <!-- Only for demo purpose -->
        <script src="~/js/skin.config.js"></script>
    </environment>
    <environment names="Staging,Production">
        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="~/lib_bower/metisMenu/dist/metisMenu.min.js"></script>
        <script data-pace-options='{ "ajax": false,  "restartOnRequestAfter": false }' src="~/lib_bower/pace/pace.min.js"></script>
        <script src="~/lib_bower/slimScroll/jquery.slimscroll.min.js"></script>
        <script src="~/lib_bower/toastr/toastr.min.js"></script>
        <script src="~/js/script.js" asp-append-version="true"></script>
        <script src="~/js/signalr.js"></script>        
    </environment>

 
    <script>
        $(document).ready(function () {
                toastr.options = {
                "closeButton": true,
                "debug": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "onclick": null,
                "showDuration": "400",
                "hideDuration": "1000",
                "timeOut": "7000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }                 
        });

        let hubUrl = '/message';
        const hubConnection = new signalR.HubConnectionBuilder()
        .withUrl(hubUrl)
        .configureLogging(signalR.LogLevel.Information)
        .build();
 
        hubConnection.on("ShowNoty", function (typeMessage, message) {    
           
            if(typeMessage=="Info")            
                toastr.info(typeMessage, message)  

             if(typeMessage=="Success")
                toastr.success(typeMessage, message) 

             if(typeMessage=="Warning")
                toastr.warning(typeMessage, message) 
  
            if(typeMessage=="Error")
                toastr.error(typeMessage, message)                     
        });


        hubConnection.on("AddMessageToLog", function (messageJson) {    
            var messageObj = JSON.parse(messageJson);

            var message = messageObj.Message;
            var type = messageObj.Type;
            var date = messageObj.Date;            

            var errorImgSrc = "/images/error.jpg";
            var infoImgSrc = "/images/info.jpg";
            var warningImgSrc = "/images/warning.jpg";
            var okImgSrc ="/images/ok.jpg";

            var imgPath;

            switch(type) {
                case 'Info':
                    imgPath = infoImgSrc;
                break

                case 'Success': 
                    imgPath = okImgSrc;
                break

                case 'Error':
                    imgPath = errorImgSrc;
                break

                case 'Warning':
                    imgPath = warningImgSrc;
                break

                default:
                    imgPath = infoImgSrc;
                break
            }

            var html =      '<div class="chat-element">'+
                                '<a href="#" class="pull-left">'+
                                    '<img alt="image" class="img-circle" src="'+imgPath+'">'+
                                '</a>'+
                                '<div class="media-body ">'+
                                    '<small class="pull-right">'+date+'</small>'+
                                    '<strong>'+type+'</strong>'+
                                    '<p class="m-b-xs">'+
                                        message +
                                    '</p>'+
                                    <!-- '<small class="text-muted">'+date+'</small>'+ -->
                                '</div>'+
                            '</div>';

            var oldHtml = $('#OutpootLogDivContent').html();
            var newHtml = oldHtml + html;

            $('#OutpootLogDivContent').html(newHtml);  

            var block = document.getElementById("OutpootLogDiv");
            var height = block.scrollHeight;   
            $('#OutpootLogDiv').animate({scrollTop: height}, 1000);                       
        });


        hubConnection.start();
    </script>

    @RenderSection("scripts", required: false)

</body>
</html>


